<UserControl x:Class="warkbench.Views.AssetEditorView"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converter="using:warkbench.Converter"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:dataTemplates="using:warkbench.DataTemplates"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:views="using:warkbench.Views"
             xmlns:vm="using:warkbench.ViewModels"
             d:DesignHeight="450"
             d:DesignWidth="800"
             x:CompileBindings="True"
             x:DataType="vm:AssetEditorViewModel"
             x:Name="Root"
             mc:Ignorable="d">
    <UserControl.Resources>
        <!--  Converter  -->
        <converter:ContextMenuConverter x:Key="ContextMenuConverter" />
        <converter:ResourceIconConverter x:Key="ResourceIconConverter" />
        <converter:ResourceIconColorConverter x:Key="ResourceIconColorConverter" />

        <!--  Extra Toolbar  -->
        <dataTemplates:ContextToolbarTemplateSelector x:Key="ContextToolbarTemplateSelector" />
    </UserControl.Resources>
    
    <Design.DataContext>
        <vm:AssetEditorViewModel />
    </Design.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="2" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Menu  -->
        <Border Grid.Row="0"
                Margin="3,3,3,0"
                Padding="6"
                Background="#191a1c">
            <StackPanel VerticalAlignment="Top" Orientation="Vertical">
                <!--  General  -->
                <Menu>
                    <!--  Assets  -->
                    <MenuItem Header="Assets">
                        
                        <!--  Add Package  -->
                        <MenuItem Header="Add Package"
                                  ItemsSource="{Binding Blueprints.Children}">
                            
                            <MenuItem.ItemTemplate>
                                <DataTemplate>
                                    <MenuItem Click="MenuItem_AddPackage"
                                              Tag="{Binding Data}">
                                        <MenuItem.Header>
                                            <TextBlock Text="{Binding Name}" />
                                        </MenuItem.Header>
                                    </MenuItem>
                                </DataTemplate>
                            </MenuItem.ItemTemplate>
                            
                            <MenuItem.Icon>
                                <PathIcon Width="16"
                                          Height="16"
                                          Foreground="LightGreen"
                                          Data="{StaticResource icon_package}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        
                        <!--  Add Blueprint  -->
                        <MenuItem Header="Add Blueprint"
                                  Command="{Binding AddBlueprint}">
                            <MenuItem.Icon>
                                <PathIcon Width="16"
                                          Height="16"
                                          Foreground="#1e90ff"
                                          Data="{StaticResource icon_blueprint_package}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        
                        <!--  Add Property  -->
                        <MenuItem Header="Add Property"
                                  Command="{Binding AddProperty}">
                            <MenuItem.Icon>
                                <PathIcon Width="16"
                                          Height="16"
                                          Foreground="Crimson"
                                          Data="{StaticResource icon_precision_manufacturing}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        
                    </MenuItem>
               </Menu>

                <!--  Context-sensitive menu bar  -->
                <ContentControl MinHeight="32"
                                Content="{Binding SelectedAsset.Data}"
                                ContentTemplate="{StaticResource ContextToolbarTemplateSelector}" />
            </StackPanel>
        </Border>

        <!--  Splitter  -->
        <GridSplitter Grid.Row="1"
                      Background="Transparent"
                      IsHitTestVisible="False"
                      ResizeDirection="Rows" />

        <!--  Assets  -->
        <ScrollViewer Grid.Row="2">
            <Border Padding="3,3,3,0"
                    Background="#191a1c">
                <StackPanel Spacing="4">
                    <Border DragDrop.AllowDrop="True">
                        <Expander HorizontalAlignment="Stretch"
                                  VerticalAlignment="Top"
                                  ExpandDirection="Down"
                                  Header="Assets"
                                  IsExpanded="True">
                            <TreeView AutoScrollToSelectedItem="True"
                                      ItemsSource="{Binding Assets}"
                                      SelectedItem="{Binding SelectedAsset}">
                                <TreeView.ItemTemplate>
                                    <TreeDataTemplate ItemsSource="{Binding Children}">
                                        <Border>
                                            <StackPanel Orientation="Horizontal">
                                                <StackPanel.ContextMenu>
                                                    <MultiBinding Converter="{StaticResource ContextMenuConverter}">
                                                        <Binding Path="Data" />
                                                        <Binding Path="DataContext" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                                                    </MultiBinding>
                                                </StackPanel.ContextMenu>
                                                
                                                <!--  Icon  -->
                                                <PathIcon Width="16"
                                                          Height="16"
                                                          Margin="0,0,6,0"
                                                          Data="{Binding Data, Converter={StaticResource ResourceIconConverter}}"
                                                          Foreground="{Binding Data, Converter={StaticResource ResourceIconColorConverter}}" />
                                                
                                                <!--  Name  -->
                                                <TextBlock Text="{Binding Name}" />
                                            </StackPanel>
                                        </Border>
                                    </TreeDataTemplate>
                                </TreeView.ItemTemplate>
                            </TreeView>
                        </Expander>
                    </Border>
                </StackPanel>
            </Border>
        </ScrollViewer>
    </Grid>
</UserControl>
